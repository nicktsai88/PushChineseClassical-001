<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>(推與敲) 第30篇 不氣歌 - 互動式古文學習 (GitHub版)</title>
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- 載入 FontAwesome 圖標 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 載入 Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #fdfbf7; /* 米紙色 */
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .font-serif {
            font-family: 'Noto Serif TC', serif;
        }

        /* 自定義滾動條 */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #d97706; 
            border-radius: 4px;
        }

        /* 標籤樣式 */
        .tab-btn {
            position: relative;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 3px;
            background-color: #b45309;
            transition: width 0.3s ease;
        }
        .tab-btn.active {
            color: #92400e;
            background-color: #fffbeb;
        }
        .tab-btn.active::after {
            width: 100%;
        }

        /* 互動文字樣式 */
        .interactive-word {
            cursor: pointer;
            border-bottom: 2px dotted #d97706;
            transition: all 0.2s;
            padding-bottom: 1px;
            position: relative;
            z-index: 20;
            color: #92400e;
            font-weight: 500;
        }
        .interactive-word:hover {
            background-color: #fef3c7;
            color: #b45309;
            border-bottom-style: solid;
        }

        /* 彈出註釋 */
        .note-popup {
            animation: fadeIn 0.2s ease-out;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px) translateX(-50%); }
            to { opacity: 1; transform: translateY(0) translateX(-50%); }
        }

        /* 懸停翻譯效果 */
        .hover-trans-container:hover .hover-translation {
            display: block;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 故事模式樣式 */
        .story-choice:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .fade-in-image {
            animation: fadeInImg 0.8s ease-out forwards;
        }
        @keyframes fadeInImg {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col">

    <!-- 頂部導航欄 -->
    <nav class="bg-amber-800 text-amber-50 shadow-lg sticky top-0 z-50">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-book-open text-2xl mr-3"></i>
                    <span class="font-bold text-xl tracking-wider">古文互動教室</span>
                </div>
                <div class="hidden md:block text-sm opacity-80">
                    GitHub Pages 版
                </div>
            </div>
        </div>
    </nav>

    <div id="app" class="max-w-5xl mx-auto p-4 sm:p-6 w-full flex-grow flex flex-col">
        
        <!-- 課程標題卡片 -->
        <header class="bg-white rounded-2xl shadow-md overflow-hidden mb-6 border border-amber-100">
            <div class="bg-gradient-to-r from-amber-100 to-orange-50 p-6 sm:p-8">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                    <div>
                        <h1 id="main-title" class="text-3xl sm:text-4xl font-serif font-bold text-amber-900 mb-2"></h1>
                        <div class="flex items-center text-amber-700 space-x-4">
                            <span class="flex items-center"><i class="fas fa-user-edit mr-2"></i><span id="author-name"></span></span>
                            <span class="flex items-center"><i class="fas fa-scroll mr-2"></i><span id="source-name"></span></span>
                        </div>
                    </div>
                    <div class="hidden md:block">
                        <span class="inline-block bg-amber-200 text-amber-900 text-xs px-3 py-1 rounded-full font-bold uppercase tracking-wide">國中語文</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- 功能標籤 -->
        <div class="flex flex-wrap justify-center bg-white rounded-xl shadow-sm mb-6 border border-gray-100 sticky top-20 z-40">
            <button id="tab-overview" class="tab-btn active px-4 py-3 md:px-6 md:py-4 font-medium text-gray-600 hover:text-amber-700" onclick="switchTab('overview')">
                <i class="fas fa-info-circle mr-2"></i>故事總覽
            </button>
            <button id="tab-reading" class="tab-btn px-4 py-3 md:px-6 md:py-4 font-medium text-gray-600 hover:text-amber-700" onclick="switchTab('reading')">
                <i class="fas fa-glasses mr-2"></i>精讀與圖解
            </button>
            <button id="tab-deep" class="tab-btn px-4 py-3 md:px-6 md:py-4 font-medium text-gray-600 hover:text-amber-700" onclick="switchTab('deep')">
                <i class="fas fa-project-diagram mr-2"></i>深度理解與地圖
            </button>
            <button id="tab-story" class="tab-btn px-4 py-3 md:px-6 md:py-4 font-medium text-gray-600 hover:text-amber-700" onclick="switchTab('story')">
                <i class="fas fa-theater-masks mr-2"></i>抉擇之路(RPG)
            </button>
            <button id="tab-vocabulary" class="tab-btn px-4 py-3 md:px-6 md:py-4 font-medium text-gray-600 hover:text-amber-700" onclick="switchTab('vocabulary')">
                <i class="fas fa-spell-check mr-2"></i>語詞精解
            </button>
            <button id="tab-analysis" class="tab-btn px-4 py-3 md:px-6 md:py-4 font-medium text-gray-600 hover:text-amber-700" onclick="switchTab('analysis')">
                <i class="fas fa-feather-alt mr-2"></i>文義與修辭
            </button>
            <button id="tab-chat" class="tab-btn px-4 py-3 md:px-6 md:py-4 font-medium text-gray-600 hover:text-amber-700" onclick="switchTab('chat')">
                <i class="fas fa-robot mr-2"></i>AI 角色扮演
            </button>
            <button id="tab-quiz" class="tab-btn px-4 py-3 md:px-6 md:py-4 font-medium text-gray-600 hover:text-amber-700" onclick="switchTab('quiz')">
                <i class="fas fa-pen-nib mr-2"></i>隨堂測驗
            </button>
        </div>

        <!-- 主要內容區 -->
        <main id="content-display" class="flex-grow bg-white rounded-2xl shadow-lg p-6 sm:p-8 min-h-[500px] transition-all duration-300 relative">
            <!-- 內容動態載入 -->
        </main>
        <!-- Tooltip container -->
        <div id="svg-tooltip" class="tooltip"></div>

    </div>

    <!-- 註釋彈出框模板 -->
    <div id="note-template" class="note-popup absolute bg-white border-l-4 border-amber-500 rounded-r-lg shadow-2xl p-4 z-50 hidden w-64" onclick="event.stopPropagation()">
        <!-- 關閉按鈕 -->
        <button onclick="closeNote()" class="absolute top-2 right-2 text-gray-400 hover:text-amber-600 transition">
            <i class="fas fa-times"></i>
        </button>
        <div id="note-content">
            <!-- 內容動態填充 -->
        </div>
    </div>

    <!-- 錯誤提示 -->
    <div id="error-toast" class="fixed bottom-6 right-6 bg-red-50 border border-red-200 text-red-600 px-6 py-4 rounded-lg shadow-xl hidden z-50 flex items-center transition-all transform translate-y-10 opacity-0">
        <i class="fas fa-exclamation-circle mr-3 text-xl"></i>
        <div>
            <p class="font-bold">發生錯誤</p>
            <p id="error-msg" class="text-sm"></p>
        </div>
    </div>

    <script>
        // ----------------------------------------------------
        // 1. 教材資料結構 (Content Data) - 不氣歌
        // ----------------------------------------------------
        const contentData = {
            metadata: {
                title: "(推與敲) 第30篇 不氣歌",
                author: "佚名",
                source: "民間流傳"
            },
            summary: "《不氣歌》是一首流傳甚廣的通俗詩歌，以淺顯易懂的語言，勸導世人莫要為了他人的過錯而生氣。詩中闡述了生氣對身體健康的危害，指出生病求醫的困難與痛苦，並點破「氣」往往是中了別人的計謀。作者以親身經歷（嘗過氣中味）現身說法，強調保持心平氣和、不生氣才是養生與處世的真諦。全詩節奏輕快，朗朗上口，富有深刻的人生哲理。",
            
            meaning: "這首詩的核心思想是「修身養性」與「心理健康」。它指出了情緒（特別是憤怒）與生理健康之間的密切關聯。1. **因果觀**：他人生氣是他人的事，若我跟著生氣，就是「中計」。2. **健康觀**：生氣會導致疾病（氣出病來），且心病難醫（治非易）。3. **價值觀**：為了生氣而損害健康甚至生命（把命棄），是非常不值得的。整首詩旨在教導人們用智慧化解憤怒，保持內心的平和。",
            
            rhetoric: [
                "**對比 (Contrast):** 「他人生氣」與「我不氣」形成鮮明對比，突顯了作者的主體性與修養。",
                "**頂真 (Anadiplosis):** 雖非嚴格頂真，但句句扣住「氣」字，反覆強調，增強了語氣與節奏感。",
                "**設問與解答 (Q&A structure implied):** 詩歌隱含了「為什麼不要生氣？」的問題，並通過醫藥無效、無人替代受苦等理由給出解答。",
                "**口語化 (Colloquialism):** 使用「中他計」、「無人替」等通俗語言，使道理易於被大眾接受與傳播。",
                "**疊字 (Reduplication):** 結尾「不氣不氣真不氣」，連用三個「不氣」，強化了決心與信念。"
            ],
            
            vocabulary: [
                { word: "他人", zhuyin: "ㄊㄚ ㄖㄣˊ", pos: "代詞", meaning: "別人，指除了自己以外的人。" },
                { word: "本", zhuyin: "ㄅㄣˇ", pos: "副詞", meaning: "本來、原來。表示原本的狀態。" },
                { word: "無心", zhuyin: "ㄨˊ ㄒㄧㄣ", pos: "形容詞/副詞", meaning: "沒有意圖、不在意。這裡指不把對方的情緒放在心上。" },
                { word: "治", zhuyin: "ㄓˋ", pos: "動詞", meaning: "治療、醫治。" },
                { word: "反", zhuyin: "ㄈㄢˇ", pos: "副詞", meaning: "反而、卻。表示出乎意料的轉折。" },
                { word: "氣病", zhuyin: "ㄑㄧˋ ㄅㄧㄥˋ", pos: "名詞", meaning: "因為生氣而引起的疾病，多指心理或情緒導致的身體不適。" },
                { word: "非易", zhuyin: "ㄈㄟ ㄧˋ", pos: "形容詞片語", meaning: "不容易、很困難。易，容易。" },
                { word: "倘若", zhuyin: "ㄊㄤˇ ㄖㄨㄛˋ", pos: "連接詞", meaning: "如果、假使。" },
                { word: "中計", zhuyin: "ㄓㄨㄥˋ ㄐㄧˋ", pos: "動詞片語", meaning: "落入圈套、中了別人的計謀。" },
                { word: "計", zhuyin: "ㄐㄧˋ", pos: "名詞", meaning: "計謀、圈套。" },
                { word: "替", zhuyin: "ㄊㄧˋ", pos: "動詞", meaning: "代替、替換。指病痛只能自己承受。" },
                { word: "危害", zhuyin: "ㄨㄟˊ ㄏㄞˋ", pos: "名詞/動詞", meaning: "禍害、傷害；使受破壞。" },
                { word: "可懼", zhuyin: "ㄎㄜˇ ㄐㄩˋ", pos: "形容詞", meaning: "令人恐懼、可怕的。懼，害怕。" },
                { word: "誠恐", zhuyin: "ㄔㄥˊ ㄎㄨㄥˇ", pos: "副詞", meaning: "實在擔心、確實恐怕。" },
                { word: "因", zhuyin: "ㄧㄣ", pos: "介詞/連詞", meaning: "因為、由於。" },
                { word: "棄", zhuyin: "ㄑㄧˋ", pos: "動詞", meaning: "拋棄、喪失。這裡指失去生命。" },
                { word: "今", zhuyin: "ㄐㄧㄣ", pos: "名詞/副詞", meaning: "現在、如今。" },
                { word: "嘗", zhuyin: "ㄔㄤˊ", pos: "動詞", meaning: "曾經、體驗過。" },
                { word: "味", zhuyin: "ㄨㄟˋ", pos: "名詞", meaning: "滋味、感受。指生氣帶來的痛苦後果。" }
            ],

            segments: [
                {
                    original: "他人生氣我不氣，我本無心他來氣。",
                    translation: "別人都在生氣，我卻不生氣；我本來就無意去招惹他，是他自己要生氣的（或者：我心裡根本不在意他生氣這件事）。",
                    audioText: "他人生氣我不氣，我本無心他來氣。",
                    notes: {
                        "他人": { zhuyin: "ㄊㄚ ㄖㄣˊ", type: "代詞", def: "別人。" },
                        "本": { zhuyin: "ㄅㄣˇ", type: "副詞", def: "本來。" },
                        "無心": { zhuyin: "ㄨˊ ㄒㄧㄣ", type: "形容詞", def: "不在意、沒意圖。" }
                    },
                    // Modified: using images/ prefix
                    imageData: "images/reading_segment_1.jpg"
                },
                {
                    original: "請來醫生將病治，反說氣病治非易。",
                    translation: "生了氣病請醫生來治療，醫生卻說這種因氣而生的病最難醫治。",
                    audioText: "請來醫生將病治，反說氣病治非易。",
                    notes: {
                        "治": { zhuyin: "ㄓˋ", type: "動詞", def: "治療。" },
                        "反": { zhuyin: "ㄈㄢˇ", type: "副詞", def: "反而。" },
                        "氣病": { zhuyin: "ㄑㄧˋ ㄅㄧㄥˋ", type: "名詞", def: "因氣而生的病。" },
                        "非易": { zhuyin: "ㄈㄟ ㄧˋ", type: "形容詞", def: "不容易。" }
                    },
                    imageData: "images/reading_segment_2.jpg"
                },
                {
                    original: "倘若生氣中他計，氣出病來無人替。",
                    translation: "如果我跟著生氣，那就是中了對方的計謀；氣出病來，那痛苦可是沒人能代替我承受的。",
                    audioText: "倘若生氣中他計，氣出病來無人替。",
                    notes: {
                        "倘若": { zhuyin: "ㄊㄤˇ ㄖㄨㄛˋ", type: "連接詞", def: "如果。" },
                        "中計": { zhuyin: "ㄓㄨㄥˋ ㄐㄧˋ", type: "動詞", def: "中了圈套。" },
                        "計": { zhuyin: "ㄐㄧˋ", type: "名詞", def: "計謀。" },
                        "替": { zhuyin: "ㄊㄧˋ", type: "動詞", def: "代替。" }
                    },
                    imageData: "images/reading_segment_3.jpg"
                },
                {
                    original: "氣字危害真可懼，誠恐因病把命棄。",
                    translation: "「氣」這個字的危害真是令人恐懼，實在擔心因為生氣得病而丟了性命。",
                    audioText: "氣字危害真可懼，誠恐因病把命棄。",
                    notes: {
                        "危害": { zhuyin: "ㄨㄟˊ ㄏㄞˋ", type: "名詞", def: "傷害。" },
                        "可懼": { zhuyin: "ㄎㄜˇ ㄐㄩˋ", type: "形容詞", def: "令人恐懼。" },
                        "誠恐": { zhuyin: "ㄔㄥˊ ㄎㄨㄥˇ", type: "副詞", def: "實在擔心。" },
                        "因": { zhuyin: "ㄧㄣ", type: "連詞", def: "因為。" },
                        "棄": { zhuyin: "ㄑㄧˋ", type: "動詞", def: "拋棄、喪失。" }
                    },
                    imageData: "images/reading_segment_4.jpg"
                },
                {
                    original: "我今嘗過氣中味，不氣不氣真不氣。",
                    translation: "我如今已經嘗過了生氣的痛苦滋味，所以我決定不再生氣，真的不再生氣了。",
                    audioText: "我今嘗過氣中味，不氣不氣真不氣。",
                    notes: {
                        "今": { zhuyin: "ㄐㄧㄣ", type: "副詞", def: "現在。" },
                        "嘗": { zhuyin: "ㄔㄤˊ", type: "動詞", def: "曾經體驗。" },
                        "味": { zhuyin: "ㄨㄟˋ", type: "名詞", def: "滋味、後果。" }
                    },
                    imageData: "images/reading_segment_5.jpg"
                }
            ],
            quiz: [
                { q: "「他人生氣我不氣」展現了作者什麼樣的態度？", opts: ["A. 冷漠無情", "B. 修養與定力", "C. 膽小怕事", "D. 遲鈍"], ans: "B", exp: "面對他人情緒而不受影響，是修養的表現。" },
                { q: "文中提到醫生對於「氣病」的看法是？", opts: ["A. 很容易治", "B. 吃藥就好", "C. 治非易（很難治）", "D. 不需要治"], ans: "C", exp: "原文：「反說氣病治非易」。" },
                { q: "「中他計」的意思是？", opts: ["A. 幫他計算", "B. 聽從他的建議", "C. 落入對方的圈套", "D. 猜中他的心思"], ans: "C", exp: "指因為生氣而讓對方達到目的，損害了自己。" },
                { q: "「氣出病來無人替」這句話強調了什麼？", opts: ["A. 生病很孤單", "B. 要找人幫忙生病", "C. 身體健康的個人責任", "D. 醫生不負責任"], ans: "C", exp: "強調病痛的後果只能由自己承擔，無人能代勞。" },
                { q: "「誠恐因病把命棄」的「棄」字意思是？", opts: ["A. 拋棄、喪失", "B. 哭泣", "C. 氣憤", "D. 器具"], ans: "A", exp: "棄，丟掉、喪失（性命）。" },
                { q: "作者為什麼最後說「不氣不氣真不氣」？", opts: ["A. 他在練習說話", "B. 他嘗過生氣的痛苦滋味", "C. 他被強迫的", "D. 他為了押韻"], ans: "B", exp: "原文：「我今嘗過氣中味」，表示是經驗之談。" },
                { q: "這首詩主要在勸導人們注重什麼？", opts: ["A. 運動健身", "B. 飲食衛生", "C. 情緒管理與心理健康", "D. 努力賺錢"], ans: "C", exp: "全篇圍繞著「氣」（情緒）對健康的影響。" },
                { q: "「我本無心他來氣」的「無心」是指？", opts: ["A. 沒有心臟", "B. 無意、不在意", "C. 狠心", "D. 開心"], ans: "B", exp: "指內心不掛礙，或者無意招惹。" },
                { q: "下列何者不是生氣可能帶來的後果？", opts: ["A. 生病", "B. 中計", "C. 無人替苦", "D. 獲得讚賞"], ans: "D", exp: "生氣在文中只有負面後果。" },
                { q: "這首《不氣歌》通常被歸類為哪種文學形式？", opts: ["A. 律詩", "B. 絕句", "C. 打油詩或勸世文", "D. 詞"], ans: "C", exp: "形式自由，通俗易懂，屬於勸世性質的歌謠。" },
                { q: "「良藥苦口」與本詩哪一句話概念相反？", opts: ["A. 氣病治非易", "B. 他人生氣我不氣", "C. 不氣不氣真不氣", "D. 無人替"], ans: "A", exp: "良藥雖苦能治病，但「氣病」連醫生都覺得難治，強調心理因素的重要。" },
                { q: "從現代醫學角度看，「氣出病來」是否有根據？", opts: ["A. 完全迷信", "B. 有，情緒影響免疫與內分泌", "C. 只有古代人才會", "D. 只有小孩會"], ans: "B", exp: "現代醫學證實負面情緒與多種疾病（如高血壓、心臟病）有關。" },
                { q: "面對他人生氣，最好的應對方式是？", opts: ["A. 比他更生氣", "B. 打他", "C. 保持冷靜，不隨之起舞", "D. 逃跑"], ans: "C", exp: "呼應「他人生氣我不氣」。" },
                { q: "「氣字危害真可懼」的「懼」意思是？", opts: ["A. 拒絕", "B. 害怕", "C. 具備", "D. 距離"], ans: "B", exp: "懼，恐懼、害怕。" },
                { q: "「嘗過氣中味」的「味」是指？", opts: ["A. 氣味", "B. 美味", "C. 感受、後果", "D. 調味料"], ans: "C", exp: "指體驗過生氣帶來的不好感受。" },
                { q: "這首詩的韻腳主要押什麼韻？", opts: ["A. ㄢ (an)", "B. ㄧ (i/yi)", "C. ㄨ (u)", "D. ㄚ (a)"], ans: "B", exp: "氣(qi), 易(yi), 計(ji), 替(ti), 懼(ju), 棄(qi), 味(wei) - 多為ㄧ或類似韻母。" },
                { q: "如果你是醫生，對於「氣病」你會建議？", opts: ["A. 只能開刀", "B. 放寬心胸，調節情緒", "C. 多吃補品", "D. 繼續生氣"], ans: "B", exp: "心病還須心藥醫。" },
                { q: "「無人替」在修辭上屬於？", opts: ["A. 誇飾", "B. 譬喻", "C. 映襯", "D. 直述"], ans: "D", exp: "直接敘述事實。" },
                { q: "下列哪個成語與本詩主旨最接近？", opts: ["A. 怒髮衝冠", "B. 心平氣和", "C. 七竅生煙", "D. 暴跳如雷"], ans: "B", exp: "勸人保持心平氣和。" },
                { q: "為什麼說生氣是「中他計」？", opts: ["A. 因為對方想給你錢", "B. 因為對方可能故意激怒你讓你失態", "C. 因為對方在演戲", "D. 因為這是計程車"], ans: "B", exp: "對方可能故意激怒，若隨之起舞則正中下懷。" }
            ]
        };

        // ----------------------------------------------------
        // 2. 全域狀態管理
        // ----------------------------------------------------
        let currentTab = 'overview';
        let chatHistory = [];
        let isGeneratingImage = false;
        let currentAudio = null;
        let currentPersona = 'bookboy'; 
        let hasPreloadedStory = false;
        let userAnswers = {}; 

        window.onload = function() {
            document.getElementById('main-title').textContent = contentData.metadata.title;
            document.getElementById('author-name').textContent = contentData.metadata.author;
            document.getElementById('source-name').textContent = contentData.metadata.source;
            switchTab('overview');

            if ('speechSynthesis' in window) {
                 window.speechSynthesis.onvoiceschanged = function() {
                    window.speechSynthesis.getVoices();
                };
            }

            document.addEventListener('click', (e) => {
                const popup = document.getElementById('note-template');
                if (!e.target.closest('.interactive-word') && !e.target.closest('.note-popup')) {
                    closeNote();
                }
            });
        };

        function closeNote() {
            const popup = document.getElementById('note-template');
            if(popup) {
                popup.classList.add('hidden');
                popup.style.display = ''; 
            }
        }

        function switchTab(tabId) {
            currentTab = tabId;
            closeNote();

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');

            const container = document.getElementById('content-display');
            container.style.opacity = '0';
            
            setTimeout(() => {
                switch(tabId) {
                    case 'overview': renderOverview(container); break;
                    case 'reading': renderReading(container); break;
                    case 'deep': renderDeepUnderstanding(container); break;
                    case 'vocabulary': renderVocabulary(container); break;
                    case 'analysis': renderAnalysis(container); break;
                    case 'chat': renderChat(container); break;
                    case 'quiz': renderQuiz(container); break;
                    case 'story': 
                        renderStory(container); 
                        break;
                }
                container.style.opacity = '1';
            }, 200);
        }

        function renderOverview(container) {
            container.innerHTML = `
                <div class="max-w-3xl mx-auto">
                    <div class="bg-amber-50 rounded-xl p-6 border-l-8 border-amber-600 mb-8">
                        <h2 class="text-2xl font-bold text-amber-900 mb-4"><i class="fas fa-scroll mr-2"></i>全文概覽</h2>
                        <p class="text-lg text-gray-700 leading-loose text-justify">${contentData.summary}</p>
                    </div>
                    
                    <div class="flex justify-center">
                         <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm hover:shadow-md transition flex flex-col justify-center items-center text-center max-w-md w-full">
                            <div class="w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center mb-4">
                                <i class="fas fa-heartbeat text-amber-600 text-2xl"></i>
                            </div>
                            <h3 class="font-bold text-gray-800 mb-2">學習重點</h3>
                            <p class="text-gray-600 text-sm">學習情緒管理，理解心理對生理健康的影響，培養豁達的人生觀。</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderReading(container) {
            let segmentsHtml = contentData.segments.map((seg, idx) => {
                let displayHtml = seg.original;
                Object.keys(seg.notes).forEach(key => {
                    displayHtml = displayHtml.replace(key, `<span class="interactive-word" onclick="showNote('${key}', ${idx}, this, event)">${key}</span>`);
                });

                // Modified: using images/ prefix and removing placeholder logic since images are guaranteed
                let imageSection = `<div class="mt-6 rounded-lg overflow-hidden shadow-lg animate-fade-in"><img src="${seg.imageData}" class="w-full h-auto rounded-lg shadow-md" alt="段落插圖" onerror="this.style.display='none'"></div>`;

                return `
                    <div class="group mb-12 relative pl-6 border-l-4 border-gray-200 hover:border-amber-500 transition-colors duration-300">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs font-bold text-gray-400 uppercase tracking-widest">段落 ${idx + 1}</span>
                            <div class="flex gap-2">
                                <button onclick="playAudio('${seg.audioText}')" class="w-8 h-8 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center hover:bg-amber-200 transition" title="朗讀">
                                    <i class="fas fa-volume-up text-sm"></i>
                                </button>
                            </div>
                        </div>
                        <div class="relative hover-trans-container cursor-help py-2">
                            <p class="text-2xl sm:text-3xl font-serif text-gray-800 leading-relaxed relative z-10">${displayHtml}</p>
                            <div class="hover-translation hidden absolute left-0 top-full mt-2 w-full z-20">
                                <div class="bg-white/95 backdrop-blur-sm p-4 rounded-lg text-gray-700 text-lg leading-7 border border-amber-200 shadow-xl relative">
                                    <div class="absolute -top-2 left-8 w-4 h-4 bg-white border-t border-l border-amber-200 transform rotate-45"></div>
                                    <span class="font-bold text-amber-700 mr-1"><i class="fas fa-language mr-1"></i>語譯：</span> ${seg.translation}
                                </div>
                            </div>
                        </div>
                        ${imageSection}
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <div class="flex flex-col md:flex-row gap-6 mb-8 items-center bg-amber-50 p-4 rounded-xl border border-amber-100">
                    <div class="flex-grow">
                        <h3 class="font-bold text-amber-900 text-lg">AI 意境圖解</h3>
                        <p class="text-sm text-amber-700">體會詩中「氣」與「病」的關聯 (本地圖片版)</p>
                    </div>
                </div>
                <div class="max-w-3xl mx-auto">
                    ${segmentsHtml}
                </div>
                <div class="text-center mt-12 pb-6 text-gray-400 text-sm space-y-1">
                    <p><i class="fas fa-mouse-pointer mr-1"></i> 點擊底線文字查看註釋</p>
                    <p><i class="fas fa-hand-pointer mr-1"></i> 滑鼠移過古文即可查看翻譯</p>
                </div>
            `;
        }
        
        function renderDeepUnderstanding(container) {
            container.innerHTML = `
                <div class="space-y-12">
                    <!-- Visual Diagram Section -->
                    <section>
                        <h2 class="text-2xl font-bold text-amber-900 mb-4"><i class="fas fa-balance-scale mr-2"></i>怒氣與健康循環圖</h2>
                        <div class="bg-white rounded-xl shadow-lg p-0 border-4 border-amber-200 relative overflow-hidden flex justify-center items-center" style="height: 400px;">
                             <svg viewBox="0 0 600 400" class="w-full h-full">
                                <!-- Central concept -->
                                <circle cx="300" cy="200" r="50" fill="#fee2e2" stroke="#ef4444" stroke-width="3" />
                                <text x="300" y="205" text-anchor="middle" font-size="24" font-weight="bold" fill="#991b1b">氣</text>
                                
                                <!-- Left: Trigger -->
                                <rect x="50" y="175" width="100" height="50" rx="10" fill="#e5e7eb" stroke="#374151" />
                                <text x="100" y="205" text-anchor="middle" font-weight="bold">他人挑釁</text>
                                
                                <!-- Arrow to Center -->
                                <path d="M150,200 L250,200" stroke="#666" stroke-width="2" marker-end="url(#arrow)" />

                                <!-- Right Top: Consequence (Anger) -->
                                <rect x="450" y="100" width="100" height="50" rx="10" fill="#fca5a5" stroke="#dc2626" />
                                <text x="500" y="130" text-anchor="middle" font-weight="bold">生氣 (中計)</text>

                                <!-- Right Bottom: Consequence (Calm) -->
                                <rect x="450" y="300" width="100" height="50" rx="10" fill="#bbf7d0" stroke="#166534" />
                                <text x="500" y="330" text-anchor="middle" font-weight="bold">不氣 (智慧)</text>

                                <!-- Path Anger -->
                                <path d="M340,180 Q400,150 450,125" fill="none" stroke="#dc2626" stroke-width="3" marker-end="url(#arrow-red)" />
                                <text x="450" y="80" font-size="12" fill="#dc2626">病痛/傷身</text>

                                <!-- Path Calm -->
                                <path d="M340,220 Q400,250 450,300" fill="none" stroke="#166534" stroke-width="3" marker-end="url(#arrow-green)" />
                                <text x="450" y="370" font-size="12" fill="#166534">身心安康</text>

                                <defs>
                                    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
                                    </marker>
                                    <marker id="arrow-red" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#dc2626" />
                                    </marker>
                                    <marker id="arrow-green" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                                        <polygon points="0 0, 10 3.5, 0 7" fill="#166534" />
                                    </marker>
                                </defs>
                            </svg>
                        </div>
                    </section>

                    <!-- Relationship Map Section -->
                    <section>
                        <h2 class="text-2xl font-bold text-amber-900 mb-4"><i class="fas fa-project-diagram mr-2"></i>因果關係圖譜</h2>
                        <div class="bg-white rounded-xl shadow-lg p-6 border border-amber-100 flex justify-center overflow-x-auto">
                            <svg width="600" height="200">
                                <!-- Nodes -->
                                <g transform="translate(100, 100)">
                                    <circle r="40" fill="#dbeafe" stroke="#2563eb" stroke-width="2" />
                                    <text y="5" text-anchor="middle" font-weight="bold">他人</text>
                                </g>
                                
                                <g transform="translate(300, 100)">
                                    <circle r="40" fill="#fef3c7" stroke="#d97706" stroke-width="2" />
                                    <text y="5" text-anchor="middle" font-weight="bold">我</text>
                                </g>

                                <g transform="translate(500, 100)">
                                    <circle r="40" fill="#fee2e2" stroke="#ef4444" stroke-width="2" />
                                    <text y="5" text-anchor="middle" font-weight="bold">醫生/病</text>
                                </g>

                                <!-- Links -->
                                <path d="M140,100 L260,100" stroke="#666" stroke-width="2" marker-end="url(#arrow)" />
                                <text x="200" y="90" text-anchor="middle" font-size="12">給氣受</text>

                                <path d="M340,100 L460,100" stroke="#dc2626" stroke-width="2" stroke-dasharray="4,4" marker-end="url(#arrow-red)" />
                                <text x="400" y="90" text-anchor="middle" font-size="12" fill="#dc2626">若生氣則得病</text>
                                <text x="400" y="120" text-anchor="middle" font-size="12" fill="#dc2626">治非易</text>
                            </svg>
                        </div>
                    </section>
                </div>
            `;
        }

        function renderVocabulary(container) {
            const cardsHtml = contentData.vocabulary.map(item => `
                <div class="bg-white border border-amber-100 rounded-xl p-5 shadow-sm hover:shadow-md transition duration-200 flex flex-col h-full">
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-2xl font-bold text-amber-900">${item.word}</h3>
                    </div>
                    <div class="text-sm text-gray-500 mb-2 font-mono bg-amber-50 inline-block px-2 py-1 rounded self-start">
                        ${item.zhuyin} • <span class="text-amber-700 font-semibold">${item.pos}</span>
                    </div>
                    <p class="text-gray-700 text-lg leading-relaxed flex-grow">${item.meaning}</p>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="max-w-4xl mx-auto">
                    <h2 class="text-3xl font-bold text-center mb-8 text-amber-900 font-serif">語詞精解</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${cardsHtml}
                    </div>
                </div>
            `;
        }

        function renderAnalysis(container) {
            const rhetoricHtml = contentData.rhetoric.map(r => `
                <div class="flex items-start mb-4 p-4 bg-white rounded-lg border border-gray-100 shadow-sm">
                    <div class="flex-shrink-0 mr-4">
                        <div class="w-8 h-8 bg-amber-100 rounded-full flex items-center justify-center text-amber-600 font-bold">
                            <i class="fas fa-pen-fancy"></i>
                        </div>
                    </div>
                    <div>
                        ${marked.parse(r)}
                    </div>
                </div>
            `).join('');

            container.innerHTML = `
                <div class="max-w-3xl mx-auto space-y-10">
                    <section>
                        <h2 class="text-2xl font-bold text-amber-900 mb-4 flex items-center">
                            <i class="fas fa-book-reader mr-3"></i>全文主旨與寓意
                        </h2>
                        <div class="bg-amber-50 p-6 rounded-xl border-l-8 border-amber-600 shadow-sm text-lg text-gray-800 leading-loose">
                            ${contentData.meaning}
                        </div>
                    </section>
                    <section>
                        <h2 class="text-2xl font-bold text-amber-900 mb-4 flex items-center">
                            <i class="fas fa-highlighter mr-3"></i>修辭與寫作技巧
                        </h2>
                        <div class="bg-gray-50 p-6 rounded-xl border border-gray-200">
                            ${rhetoricHtml}
                        </div>
                    </section>
                </div>
            `;
        }

        function renderChat(container) {
            container.innerHTML = `
                <div class="flex flex-col items-center justify-center h-[400px] text-center text-gray-500">
                    <i class="fas fa-robot text-4xl mb-4 text-gray-300"></i>
                    <p>AI 角色扮演功能僅支援線上模式。</p>
                    <p class="text-sm mt-2">（本地版不具備連網對話能力）</p>
                </div>
            `;
        }

        function renderQuiz(container) {
            let quizHtml = contentData.quiz.map((q, i) => {
                const val = ["A","B","C","D"];
                const isAnswered = userAnswers[i] !== undefined;
                const userAnswer = userAnswers[i];
                let feedback = '';
                let cardClass = "bg-white border border-gray-200";
                
                if (isAnswered) {
                    if (userAnswer === q.ans) {
                        feedback = `<div class="mt-4 p-3 rounded-lg text-sm bg-green-50 text-green-800"><strong class="block mb-1"><i class="fas fa-check-circle mr-1"></i>答對了！</strong>${q.exp}</div>`;
                        cardClass = "bg-white border border-green-500";
                    } else {
                        feedback = `<div class="mt-4 p-3 rounded-lg text-sm bg-red-50 text-red-800"><strong class="block mb-1"><i class="fas fa-times-circle mr-1"></i>再想一下...</strong>提示：${q.exp.substring(0, 15)}...</div>`;
                        cardClass = "bg-white border border-red-500";
                    }
                }

                return `
                <div class="${cardClass} rounded-xl p-6 mb-6 shadow-sm" id="quiz-card-${i}">
                    <p class="font-bold text-lg text-gray-800 mb-4"><span class="text-amber-600 mr-2">Q${i+1}.</span>${q.q}</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${q.opts.map((opt, optIdx) => {
                            const val = ["A","B","C","D"][optIdx];
                            const isChecked = userAnswer === val ? 'checked' : '';
                            return `
                            <label class="flex items-center p-3 rounded-lg border border-gray-100 hover:bg-amber-50 cursor-pointer transition group">
                                <input type="radio" name="q-${i}" value="${val}" class="mr-3 text-amber-600 focus:ring-amber-500" onchange="checkAnswer(${i}, '${val}', '${q.ans}')" ${isChecked}>
                                <span class="group-hover:text-amber-800">${opt}</span>
                            </label>
                            `;
                        }).join('')}
                    </div>
                    <div id="feedback-${i}">${feedback}</div>
                </div>
            `}).join('');
            
            container.innerHTML = `
                <div class="max-w-3xl mx-auto">
                    <h2 class="text-2xl font-bold text-center mb-8 text-gray-700">小試身手 (共20題)</h2>
                    ${quizHtml}
                    <div class="text-center mt-8 pb-8">
                        <button onclick="resetQuiz()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-full transition">重置測驗</button>
                    </div>
                </div>
            `;
        }

        // [Tab Story] 抉擇之路 (RPG) - 已修改為使用本地圖片
        const storyNodes = {
            start: {
                id: 'start',
                text: "你是一個忙碌的商人，今天生意不好，心情正煩躁。走在路上，一個路人沒長眼睛撞了你一下，連句道歉都沒有就走了。",
                // Modified: using images/ prefix
                imageData: "images/rpg_start.jpg",
                choices: [
                    { text: "大聲叫罵，追上去理論", next: "anger" },
                    { text: "深呼吸，想著「他人生氣我不氣」", next: "calm" }
                ]
            },
            anger: {
                id: 'anger',
                text: "你氣不過，衝上去跟他大吵一架。兩人推擠之中，你突然覺得胸口一陣悶痛，頭暈目眩...",
                imageData: "images/rpg_anger.jpg",
                choices: [
                    { text: "繼續罵，不能輸了氣勢", next: "bad_sick" },
                    { text: "停下來，趕快去看醫生", next: "doctor" }
                ]
            },
            calm: {
                id: 'calm',
                text: "你拍拍身上的灰塵，心想：「我本無心他來氣，何必拿別人的錯誤懲罰自己？」你轉身離開，心情反而變好了。",
                imageData: "images/rpg_calm.jpg",
                choices: [
                    { text: "去茶樓喝杯茶", next: "good_tea" }
                ]
            },
            doctor: {
                id: 'doctor',
                text: "你來到醫館。大夫把了脈，搖搖頭說：「這是氣急攻心，傷了肝臟。氣病治非易啊！得好好調養，不能再動怒了。」",
                imageData: "images/rpg_doctor.jpg",
                choices: [
                    { text: "聽醫生的話，修身養性", next: "recover" },
                    { text: "生氣醫生收費太貴", next: "bad_worse" }
                ]
            },
            bad_sick: {
                id: 'bad_sick',
                text: "【Bad Ending: 氣出病來】你越罵越激動，突然眼前一黑，倒在地上。醒來後發現自己中風了，躺在床上動彈不得。這真是「氣出病來無人替」。",
                imageData: "images/rpg_bad_sick.jpg",
                choices: [{ text: "重來", next: "start" }],
                isEnding: true
            },
            bad_worse: {
                id: 'bad_worse',
                text: "【Bad Ending: 因病棄命】你連看醫生都在生氣，病情加重。沒過多久，就因為這口「閒氣」一命嗚呼了。真是「誠恐因病把命棄」。",
                imageData: "images/rpg_bad_worse.jpg",
                choices: [{ text: "重來", next: "start" }],
                isEnding: true
            },
            good_tea: {
                id: 'good_tea',
                text: "【Good Ending: 不氣真不氣】你在茶樓聽著小曲，覺得人生美好。剛才那個撞你的人，聽說後來跟別人打架被抓進官府了。你慶幸自己沒有「中他計」。",
                imageData: "images/rpg_good_tea.jpg",
                choices: [{ text: "重新體驗", next: "start" }],
                isEnding: true,
                win: true
            },
            recover: {
                id: 'recover',
                text: "【Good Ending: 嘗過氣中味】經過一段時間的調養，身體終於康復。你深刻體會到「氣字危害真可懼」，從此變成了一個心平氣和的人。",
                imageData: "images/rpg_recover.jpg",
                choices: [{ text: "重新體驗", next: "start" }],
                isEnding: true,
                win: true
            }
        };

        function renderStory(container) {
            if(!window.currentStoryNode) window.currentStoryNode = 'start';
            const node = storyNodes[window.currentStoryNode];

            // Modified: Direct image display without loading state or placeholders
            let imageContent = `<div class="w-full overflow-hidden rounded-t-xl"><img src="${node.imageData}" class="w-full h-auto fade-in-image" alt="場景圖" onerror="this.style.display='none'"></div>`;

            container.innerHTML = `<div class="max-w-2xl mx-auto bg-white rounded-xl shadow-xl overflow-hidden border border-amber-100">${imageContent}<div class="p-8"><div class="flex items-center mb-4 text-amber-800 text-sm font-bold uppercase tracking-widest"><i class="fas fa-scroll mr-2"></i> 抉擇時刻</div><p class="text-xl leading-relaxed text-gray-800 mb-8 font-serif">${node.text}</p>${node.isEnding ? (node.win ? `<div class="text-center mb-6 text-green-600 font-bold text-2xl p-4 bg-green-50 rounded-lg border border-green-200"><i class="fas fa-trophy mr-2"></i>智慧增長！</div>` : `<div class="text-center mb-6 text-red-600 font-bold text-2xl p-4 bg-red-50 rounded-lg border border-red-200"><i class="fas fa-skull-crossbones mr-2"></i>氣大傷身</div>`) : ''}<div class="grid gap-4">${node.choices.map(c => `<button onclick="nextStoryNode('${c.next}')" class="story-choice w-full py-4 px-6 bg-white hover:bg-amber-50 border-2 border-amber-200 hover:border-amber-400 rounded-xl text-amber-900 font-bold text-lg transition duration-200 flex items-center justify-between group"><span>${c.text}</span><i class="fas fa-chevron-right text-amber-300 group-hover:text-amber-600 transition"></i></button>`).join('')}</div></div></div>`;
            if(node.win) { 
                try {
                    confetti({
                        particleCount: 150,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                } catch(e) {
                    console.log("Confetti effect skipped");
                }
            }
        }

        function nextStoryNode(nodeId) {
            window.currentStoryNode = nodeId;
            renderStory(document.getElementById('content-display'));
        }

        function checkAnswer(idx, val, ans) {
            userAnswers[idx] = val; 
            const feedbackEl = document.getElementById(`feedback-${idx}`);
            const card = document.getElementById(`quiz-card-${idx}`);
            const qData = contentData.quiz[idx];
            if (!feedbackEl || !card) return;
            
            // Reset classes first
            feedbackEl.className = 'mt-4 p-3 rounded-lg text-sm animate-fade-in';
            card.classList.remove('border-green-500', 'border-red-500');

            if (val === ans) {
                feedbackEl.innerHTML = `<strong class="block mb-1"><i class="fas fa-check-circle mr-1"></i>答對了！</strong>${qData.exp}`;
                feedbackEl.classList.add('bg-green-50', 'text-green-800');
                card.classList.add('border-green-500');
            } else {
                feedbackEl.innerHTML = `<strong class="block mb-1"><i class="fas fa-times-circle mr-1"></i>再想一下...</strong>提示：${qData.exp.substring(0, 15)}...`;
                feedbackEl.classList.add('bg-red-50', 'text-red-800');
                card.classList.add('border-red-500');
            }
            // Ensure visible
            feedbackEl.classList.remove('hidden');
        }

        function resetQuiz() {
            userAnswers = {}; 
            renderQuiz(document.getElementById('content-display'));
        }

        function showNote(key, segIdx, el, e) {
            if (e && e.stopPropagation) {
                e.stopPropagation();
            }

            const popup = document.getElementById('note-template');
            const content = document.getElementById('note-content');
            
            let noteData = null;
            
            if (segIdx !== undefined && contentData.segments[segIdx] && contentData.segments[segIdx].notes[key]) {
                noteData = contentData.segments[segIdx].notes[key];
            } else if (allKeywords[key]) {
                noteData = allKeywords[key];
            }

            if(!noteData) return;

            content.innerHTML = `
                <div class="flex items-baseline justify-between border-b border-gray-100 pb-2 mb-2">
                    <h4 class="text-xl font-bold text-amber-800">${key}</h4>
                    <span class="text-xs bg-amber-100 text-amber-800 px-2 py-0.5 rounded">${noteData.type || noteData.pos}</span>
                </div>
                <p class="text-sm text-gray-500 mb-1 font-mono">${noteData.zhuyin}</p>
                <p class="text-gray-700 leading-relaxed">${noteData.def || noteData.meaning}</p>
            `;

            const rect = el.getBoundingClientRect();
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;

            let left = rect.left + scrollLeft;
            let top = rect.bottom + scrollTop + 5; 

            if (left + 260 > document.body.clientWidth) { 
                left = document.body.clientWidth - 270;
            }

            popup.style.left = `${left}px`;
            popup.style.top = `${top}px`;
            
            popup.classList.remove('hidden');
        }

        function playAudio(text) {
            if (!('speechSynthesis' in window)) { showError("您的瀏覽器不支援語音朗讀功能。"); return; }
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-TW'; 
            utterance.rate = 0.85; 
            utterance.pitch = 1.0;
            const voices = window.speechSynthesis.getVoices();
            let targetVoice = voices.find(v => (v.lang === 'zh-TW' || v.lang === 'cmn-Hant-TW') && (v.name.includes('Google') || v.name.includes('Hanhan') || v.name.includes('Mei-Jia') || v.name.includes('Yating')));
            if (!targetVoice) { targetVoice = voices.find(v => v.lang === 'zh-TW' || v.lang === 'cmn-Hant-TW'); }
            if (!targetVoice) { targetVoice = voices.find(v => v.lang.startsWith('zh')); }
            if (targetVoice) { utterance.voice = targetVoice; }
            utterance.onerror = (e) => { console.error("Speech synthesis error:", e); showError("語音播放發生錯誤，可能是瀏覽器限制或網路問題。"); };
            window.speechSynthesis.speak(utterance);
        }
        window.speechSynthesis.onvoiceschanged = function() { window.speechSynthesis.getVoices(); };

        function showError(msg) {
            const toast = document.getElementById('error-toast');
            document.getElementById('error-msg').innerText = msg;
            toast.classList.remove('hidden');
            requestAnimationFrame(() => { toast.classList.remove('translate-y-10', 'opacity-0'); });
            setTimeout(() => { toast.classList.add('translate-y-10', 'opacity-0'); setTimeout(() => toast.classList.add('hidden'), 300); }, 4000);
        }

    </script>
</body>
</html>